<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Platform</title>
    <style>
        body { font-family: sans-serif; margin: 2em; background-color: #f4f4f9; color: #333; }
        h1 { color: #0056b3; }
        .container { max-width: 800px; margin: auto; background: white; padding: 2em; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 1.5em; }
        label { display: block; margin-bottom: 0.5em; font-weight: bold; }
        select, button { width: 100%; padding: 0.8em; border-radius: 4px; border: 1px solid #ccc; font-size: 1em; }
        button { background-color: #007bff; color: white; border: none; cursor: pointer; margin-top: 1em; }
        button:hover { background-color: #0056b3; }
        #selection-output { margin-top: 1.5em; padding: 1em; background-color: #e9ecef; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI Platform based on DINOv3</h1>
        <p>Select a task, model architecture, and model size from the options below.</p>

        <div class="form-group">
            <label for="task-type">Task Type (任務類型)</label>
            <select id="task-type" name="task_type">
                {% for task in task_types %}
                <option value="{{ task }}">{{ task }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="model-arch">Model Architecture (模型架構)</label>
            <select id="model-arch" name="model_arch">
                {% for arch in initial_architectures %}
                <option value="{{ arch }}">{{ arch }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="model-size">DINOv3 Model Size (DINO v3 模型大小)</label>
            <select id="model-size" name="model_size">
                {% for size in model_sizes %}
                <option value="{{ size }}">{{ size }}</option>
                {% endfor %}
            </select>
        </div>

        <button id="confirm-btn">Confirm Selection</button>

        <div id="selection-output">
            <p>Your selection will appear here.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const taskTypeSelect = document.getElementById('task-type');
            const modelArchSelect = document.getElementById('model-arch');
            const modelSizeSelect = document.getElementById('model-size');
            const confirmBtn = document.getElementById('confirm-btn');
            const selectionOutput = document.getElementById('selection-output');

            // Event listener for the task type dropdown
            taskTypeSelect.addEventListener('change', function () {
                const selectedTask = this.value;
                // Fetch new architectures from the Flask API
                fetch(`/api/architectures/${selectedTask}`)
                    .then(response => response.json())
                    .then(data => {
                        // Clear existing options
                        modelArchSelect.innerHTML = '';
                        // Populate with new options
                        data.forEach(arch => {
                            const option = document.createElement('option');
                            option.value = arch;
                            option.textContent = arch;
                            modelArchSelect.appendChild(option);
                        });
                    })
                    .catch(error => console.error('Error fetching architectures:', error));
            });

            // Event listener for the confirm button
            confirmBtn.addEventListener('click', function () {
                const selectedTask = taskTypeSelect.value;
                const selectedArch = modelArchSelect.value;
                const selectedSize = modelSizeSelect.value;

                if (!selectedArch) {
                    selectionOutput.innerHTML = '<p style="color: red;">Please select a valid model architecture.</p>';
                    return;
                }

                // Prepare data for POST request
                const postData = {
                    task_type: selectedTask,
                    model_arch: selectedArch,
                    model_size: selectedSize
                };

                selectionOutput.innerHTML = '<p>Sending training request...</p>';

                // Send POST request to the /train endpoint
                fetch('/train', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(postData),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'Success') {
                        selectionOutput.innerHTML = `<p style="color: green;"><strong>${data.status}:</strong> ${data.message}</p>`;
                    } else {
                        selectionOutput.innerHTML = `<p style="color: red;"><strong>${data.status}:</strong> ${data.message}</p>`;
                    }
                })
                .catch(error => {
                    console.error('Error sending training request:', error);
                    selectionOutput.innerHTML = '<p style="color: red;">An error occurred while sending the request.</p>';
                });
            });
        });
    </script>
</body>
</html>
